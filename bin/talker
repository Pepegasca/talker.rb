#!/usr/bin/env ruby
require "talker"

token_path = File.join(ENV['HOME'], '.talker')
token = File.read(token_path).strip
room = ARGV.first

abort <<-EOS unless room
usage: echo 'something' | talker <room_id>
  
  Place your Talker Token in #{token_path}. You can find your
  token in https://myaccount.talkerapp.com/settings

  Room ID is the last part of the URL:
    https://myaccount.talkerapp.com/rooms/<room_id>
  
  Send a message to a room:
  
    echo 'something' | talker <room_id>
  
  Send a file to a room:
  
    talker <room_id> < site_fixer.rb

EOS

Talker.connect(:room => room, :token => token) do |client|
  client.on_connected do
    client.send_message STDIN.read
    client.close
  end
  client.on_error do |error|
    puts error
  end
end
